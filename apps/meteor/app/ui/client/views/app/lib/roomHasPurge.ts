import type { IRoom, IRoomWithRetentionPolicy } from '@rocket.chat/core-typings';

import { settings } from '../../../../../settings/client';

function roomHasGlobalPurge(room: IRoom): boolean {
	if (!settings.get('RetentionPolicy_Enabled')) {
		return false;
	}

	switch (room.t) {
		case 'c':
			return settings.get('RetentionPolicy_AppliesToChannels');
		case 'p':
			return settings.get('RetentionPolicy_AppliesToGroups');
		case 'd':
			return settings.get('RetentionPolicy_AppliesToDMs');
	}
	return false;
}

export function roomHasPurge(room: IRoomWithRetentionPolicy): boolean {
	if (!room || !settings.get('RetentionPolicy_Enabled')) {
		return false;
	}

	if (room.retention && room.retention.enabled !== undefined) {
		return room.retention.enabled;
	}

	return roomHasGlobalPurge(room);
}
